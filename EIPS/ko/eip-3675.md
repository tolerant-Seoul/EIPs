---
eip: 3675
title: 합의를 지분 증명으로 업그레이드
description: 이더리움 메인넷에 지분 증명을 도입하는 합의 메커니즘 업그레이드 사양
author: Mikhail Kalinin (@mkalinin), Danny Ryan (@djrtwo), Vitalik Buterin (@vbuterin)
discussions-to: https://ethereum-magicians.org/t/eip-3675-upgrade-consensus-to-proof-of-stake/6706
status: Final
type: Standards Track
category: Core
created: 2021-07-22
requires: 2124
lang: ko
original: ../eip-3675.md
---

## 요약

이 EIP는 작업 증명(PoW)을 폐지하고 비콘 체인에 의해 구동되는 새로운 지분 증명 합의 메커니즘(PoS)으로 대체합니다. 새로운 합의 메커니즘의 부트스트랩에 관한 정보는 [EIP-2982](./eip-2982.md)에 문서화되어 있습니다. 비콘 체인의 전체 사양은 `ethereum/consensus-specs` 저장소에서 찾을 수 있습니다.

이 문서는 합의 업그레이드로 도입되는 블록 구조, 블록 처리, 포크 선택 규칙 및 네트워크 인터페이스에 대한 변경 사항을 명시합니다.

## 동기

비콘 체인 네트워크는 2020년 12월부터 운영되어 왔습니다. 이 기간 동안 안전성이나 활성 장애가 감지되지 않았습니다. 이 오랜 기간 동안 장애 없이 운영된 것은 비콘 체인 시스템의 지속 가능성과 이더리움 메인넷의 보안 제공자가 될 준비가 되었음을 보여줍니다.

지분 증명 합의 도입의 동기를 이해하려면 [EIP-2982](./eip-2982.md#motivation)의 동기 섹션을 참조하세요.

## 사양

### 정의

* **PoW 블록**: 기존 작업 증명 메커니즘으로 구축 및 검증되는 블록. 즉, 합의 업그레이드 이전 이더리움 네트워크의 블록.
* **PoS 블록**: 새로운 지분 증명 메커니즘으로 구축 및 검증되는 블록.
* **터미널 PoW 블록**: 다음 조건을 충족하는 PoW 블록 --
`pow_block.total_difficulty >= TERMINAL_TOTAL_DIFFICULTY` *그리고* `pow_block.parent_block.total_difficulty < TERMINAL_TOTAL_DIFFICULTY`.
네트워크에 둘 이상의 터미널 PoW 블록이 있을 수 있습니다. 예를 들어 동일한 사전 터미널 블록의 여러 자식이 있을 수 있습니다.
* **`TERMINAL_TOTAL_DIFFICULTY`** 합의 업그레이드를 트리거하는 네트워크가 도달한 총 난이도의 양. 이더리움 메인넷 구성은 이 매개변수를 `58750000000000000000000` 값으로 설정**해야 합니다(MUST)**.
* **`TRANSITION_BLOCK`** 정식 체인의 가장 초기 PoS 블록, 즉 가장 낮은 블록 높이를 가진 PoS 블록.
* **`POS_FORKCHOICE_UPDATED`** 지분 증명 포크 선택의 상태가 업데이트될 때 발생하는 이벤트.
* **`FORK_NEXT_VALUE`** 다가오는 합의 업그레이드에 대한 `FORK_NEXT` 매개변수로 설정된 블록 번호.
* **`TERMINAL_BLOCK_HASH`** 설정된 경우 터미널 PoW 블록의 해시를 지정합니다. 즉, `0x0000000000000000000000000000000000000000000000000000000000000000`으로 스텁되지 않은 경우.
* **`TERMINAL_BLOCK_NUMBER`** `TERMINAL_BLOCK_HASH`가 설정된 경우 터미널 PoW 블록의 번호를 지정합니다.

#### PoS 이벤트

이름에 `POS_` 접두사가 있는 이벤트(PoS 이벤트)는 새로운 지분 증명 합의 메커니즘에 의해 발생합니다. 이벤트로 지정된 블록에 대해 해당 주장이 이루어졌음을 나타냅니다. PoS 이벤트의 기본 로직은 비콘 체인 사양에서 찾을 수 있습니다. 각 PoS 이벤트 발생 시 이 EIP에서 지정한 해당 조치를 **반드시** 취해야 합니다(MUST).

PoS 이벤트를 참조하는 사양 부분을 읽을 때 아래 제공된 세부 사항을 고려해야 합니다:
* PoS 이벤트에 포함된 블록에 대한 참조는 달리 명시적으로 지정되지 않는 한 블록 해시 형식으로 제공됩니다.
* `POS_FORKCHOICE_UPDATED` 이벤트에는 정식 체인의 헤드와 가장 최근에 완료된 블록에 대한 참조가 포함됩니다. 시스템에서 첫 번째 완료된 블록이 발생하기 전에 이 이벤트에서 제공하는 완료된 블록 해시는 `0x0000000000000000000000000000000000000000000000000000000000000000`으로 스텁됩니다.
* **`FIRST_FINALIZED_BLOCK`** `POS_FORKCHOICE_UPDATED` 이벤트에 의해 지정되고 스텁과 다른 해시를 가진 첫 번째 완료된 블록.

### 클라이언트 소프트웨어 구성

다음 매개변수 집합은 클라이언트 소프트웨어 구성의 일부이며 바이너리 배포에 **반드시** 포함되어야 합니다(MUST):
* `TERMINAL_TOTAL_DIFFICULTY`
* `FORK_NEXT_VALUE`
* `TERMINAL_BLOCK_HASH`
* `TERMINAL_BLOCK_NUMBER`

*참고*: `TERMINAL_BLOCK_HASH`가 `0x0000000000000000000000000000000000000000000000000000000000000000`으로 스텁된 경우 `TERMINAL_BLOCK_HASH` 및 `TERMINAL_BLOCK_NUMBER` 매개변수는 효력을 발생**시키지 않아야 합니다(MUST NOT)**.

### PoW 블록 처리

터미널 PoW 블록의 후손인 PoW 블록은 **반드시** 가져오지 않아야 합니다(MUST NOT). 이는 터미널 PoW 블록이 정식 체인의 마지막 PoW 블록이 됨을 의미합니다.

### 상수

| 이름 | 값 |
|-|-|
| **`MAX_EXTRA_DATA_BYTES`** | `32` |

### 블록 구조

`TRANSITION_BLOCK`부터 여러 이전에 동적이었던 블록 필드는 이러한 값을 상수로 적용하여 폐지됩니다. 아래 표에 나열된 각 블록 필드는 **반드시** 해당 상수 값으로 교체되어야 합니다(MUST).

| 필드 | 상수 값 | 설명 |
|-|-|-|
| **`ommersHash`** | `0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347` | `= Keccak256(RLP([]))` |
| **`difficulty`** | `0` |  |
| **`mixHash`** | `0x0000000000000000000000000000000000000000000000000000000000000000` |  |
| **`nonce`** | `0x0000000000000000` |  |
| **`ommers`** | `[]` | `RLP([]) = 0xc0`  |

`TRANSITION_BLOCK`부터 블록의 **`extraData`** 필드 유효성 검사가 변경됩니다: 블록의 **`extraData`** 길이는 **반드시** **`MAX_EXTRA_DATA_BYTES`** 바이트 이하**여야 합니다(MUST)**.

*참고*: 여기에 지정되지 *않은* 블록 필드의 로직 및 유효성 조건은 **반드시** 변경되지 않아야 합니다(MUST). 또한 전체 블록 형식은 **반드시** 변경되지 않아야 합니다(MUST).

*참고*: 후속 EIP는 추가 기능을 제공하기 위해 위에 지정된 상수 값을 재정의할 수 있습니다. 예를 들어 [EIP-4399](./eip-4399.md)를 참조하세요.

### 블록 유효성

`TRANSITION_BLOCK`부터 블록 유효성 조건은 다음과 같이 **반드시** 변경되어야 합니다(MUST):
* 난이도 공식에 대한 블록의 **`difficulty`** 값 검증을 제거합니다.
* Ethash 함수에 대한 블록의 **`nonce`** 및 **`mixHash`** 값 검증을 제거합니다.
* 엉클 목록과 이 목록의 각 멤버에 대해 평가되는 모든 유효성 규칙을 제거합니다.
* [블록 구조](#블록-구조) 섹션에 명시된 필드의 검증을 추가합니다.

*참고*: 새 규칙 중 하나라도 실패하면 블록은 **반드시** 무효화되어야 합니다(MUST).

*참고*: 위 목록에 지정되지 않은 유효성 규칙은 **반드시** 변경되지 않아야 합니다(MUST).

#### 전환 블록 유효성

위의 조건을 충족하는 것 외에도 `TRANSITION_BLOCK`은 **반드시** 터미널 PoW 블록의 자식이어야 합니다(MUST). 즉, `TRANSITION_BLOCK`의 부모는 **반드시** 터미널 PoW 블록 조건을 충족해야 합니다(MUST).

### 블록 및 엉클 보상

`TRANSITION_BLOCK`부터 블록 및 엉클 보상이 폐지됩니다. 구체적으로 다음 조치를 **반드시** 취해야 합니다(MUST):
* 블록 보상에 의해 블록의 **`beneficiary`** 계정 잔액을 증가시키는 것을 제거합니다.
* 각 엉클에 대한 엉클 포함 보상에 의해 블록의 **`beneficiary`** 계정 잔액을 증가시키는 것을 제거합니다.
* 각 엉클에 대한 엉클 블록 보상에 의해 엉클의 **`beneficiary`** 계정 잔액을 증가시키는 것을 제거합니다.

*참고*: 블록의 `beneficiary` 계정에 영향을 미치는 트랜잭션 수수료 메커니즘은 **반드시** 변경되지 않아야 합니다(MUST).

### 포크 선택 규칙

설정된 경우 `TERMINAL_BLOCK_HASH` 매개변수는 다음과 같이 PoW 최중량 체인 규칙에 영향을 미칩니다:
* 정식 블록체인은 `TERMINAL_BLOCK_NUMBER` 매개변수에 의해 정의된 높이에서 `TERMINAL_BLOCK_HASH` 매개변수에 의해 정의된 해시를 가진 블록을 **반드시** 포함해야 합니다(MUST).

*참고*: 이 규칙은 클라이언트 소프트웨어 구현에 이미 존재하는 블록 해시 화이트리스트 기능과 유사합니다.

첫 번째 `POS_FORKCHOICE_UPDATED` 이벤트부터 포크 선택 규칙은 다음과 같이 **반드시** 변경되어야 합니다(MUST):
* 기존 PoW 최중량 체인 규칙을 제거합니다.
* 새로운 PoS LMD-GHOST 규칙을 준수합니다.

새로운 PoS LMD-GHOST 포크 선택 규칙은 다음과 같이 지정됩니다. 첫 번째를 포함하여 각 `POS_FORKCHOICE_UPDATED` 이벤트 발생 시 다음 조치를 **반드시** 취해야 합니다(MUST):
* 제네시스에서 시작하여 이벤트에 의해 지명된 헤드 블록으로 끝나는 체인을 정식 블록체인으로 간주합니다.
* 정식 블록체인의 헤드를 이벤트에 의해 지명된 해당 블록으로 설정합니다.
* `FIRST_FINALIZED_BLOCK`부터 가장 최근에 완료된 블록을 이벤트에 의해 지명된 해당 블록으로 설정합니다.

위의 조치와 관련된 블록 트리 저장소에 대한 변경 사항은 **반드시** 원자적으로 적용되어야 합니다(MUST).

*참고*: 이 규칙은 **반드시** 엄격하게 시행되어야 합니다(MUST). 헤드에 대한 "낙관적" 업데이트는 **반드시** 이루어지지 않아야 합니다(MUST NOT). 즉 -- 현재 헤드 블록 위에 새 블록이 처리되는 경우, 이 새 블록은 `POS_FORKCHOICE_UPDATED` 이벤트가 동반되는 경우에만 새 헤드가 됩니다.

### 네트워크

#### 포크 식별자

[EIP-2124](./eip-2124.md) 포크 식별자의 목적을 위해 이 EIP를 구현하는 노드는 **반드시** `FORK_NEXT` 매개변수를 `FORK_NEXT_VALUE`로 설정해야 합니다(MUST).

#### devp2p

네트워킹 스택은 터미널 PoW 블록의 후손을 광고하는 경우 다음 메시지를 **보내지 않아야 합니다(SHOULD NOT)**:
* `NewBlockHashes (0x01)`
* `NewBlock (0x07)`

`FIRST_FINALIZED_BLOCK`을 수신하기 시작하면 네트워킹 스택은 다음 수신 메시지를 **반드시** 폐기해야 합니다(MUST):
* `NewBlockHashes (0x01)`
* `NewBlock (0x07)`

`FIRST_FINALIZED_BLOCK` 다음의 완료된 블록을 수신하기 시작하면 네트워킹 스택은 다음 메시지에 해당하는 핸들러를 **반드시** 제거해야 합니다(MUST):
* `NewBlockHashes (0x01)`
* `NewBlock (0x07)`

핸들러가 제거된 후에도 이러한 메시지를 계속 보내는 피어는 **연결을 끊어야 합니다(SHOULD)**.

*참고:* 이 섹션의 영향을 받지 않는 메시지 핸들러의 로직은 **반드시** 변경되지 않아야 합니다(MUST).

## 근거

이 EIP에 지정된 변경 사항은 기존 작업 증명 합의 알고리즘을 이미 프로덕션 중인 비콘 체인으로 대표되는 새로운 지분 증명 합의로 안전하게 교체하기 위한 합의 및 클라이언트 소프트웨어 수정의 최소 필수 집합을 목표로 합니다.

이 EIP는 이더리움 네트워크의 실시간 합의를 핫스와핑하는 복잡성을 최소화하도록 설계되었습니다. 작업의 안전성과 프로덕션 시간이 모두 고려되었습니다. 또한 최소한의 변경 세트는 전환 중 및 전환 후에 *대부분의* 스마트 컨트랙트와 서비스가 거의 또는 전혀 필요한 개입 없이 의도한 대로 계속 작동하도록 보장합니다.

### 업그레이드를 트리거하는 총 난이도

[보안 고려사항](#터미널-총-난이도-vs-블록-번호)을 참조하세요.

### 터미널 블록 해시 매개변수화

[보안 고려사항](#터미널-pow-블록-재정의)을 참조하세요.

### PoW 블록 가져오기 중단

[보안 고려사항](#pow-블록-가져오기-중단)을 참조하세요.

### 블록 필드를 상수로 교체

폐지된 블록 필드는 블록 형식이 하위 호환되도록 상수 값으로 교체됩니다. 블록 형식을 보존하면 이 전환 중 및 전환 후에 기존 스마트 컨트랙트와 서비스가 중단 없이 서비스를 제공하는 데 도움이 됩니다.

특히 이는 트랜잭션/영수증 포함 및 상태의 머클 증명을 검증하는 스마트 컨트랙트에 중요합니다. 이는 외부에서 제공된 블록 헤더의 해시를 `BLOCKHASH` 작업에 의해 반환된 해당 값과 비교하여 검증합니다.

이 변경 사항은 폐지된 블록 필드의 교체를 시행하는 추가 유효성 규칙을 도입합니다.

### `difficulty`를 `0`으로 교체

작업 증명을 폐지한 후 난이도 개념은 더 이상 존재하지 않으며 블록 헤더 **`difficulty`** 필드를 `0` 상수로 교체하는 것이 의미적으로 타당합니다.

### 블록 유효성 규칙 변경

PoW 봉인 유효성을 시행하는 규칙 집합은 이 변경의 근거로서 합의 업그레이드와 함께 해당 PoS 규칙으로 교체됩니다.

이 사양에 의해 도입된 블록 형식 변경에 의해 폐지된 블록 필드 집합을 검증하는 추가 규칙이 필요합니다.

### 블록 보상 제거

블록 생성 및 봉인에 대한 기존 보상은 PoW 메커니즘과 함께 폐지됩니다. 새로운 PoS 합의는 이 사양이 발효되면 블록 봉인과 블록 보상 발행을 모두 담당합니다.

### 포크 선택 규칙 대체

PoW 메커니즘의 포크 선택 규칙은 업그레이드 후 완전히 무관해지며 새로운 PoS 합의 메커니즘의 해당 규칙으로 대체됩니다.

### `POS_CONSENSUS_VALIDATED` 제거

이 EIP의 이전 초안 버전에서는 블록의 유효성 검사 조건으로 추가 POS 이벤트 -- `POS_CONSENSUS_VALIDATED` --가 필요했습니다. 이 이벤트는 블록 트리에서 블록을 완전히 통합하거나 제거하라는 신호를 제공했습니다.

이 이벤트는 두 가지 이유로 제거되었습니다:
1. 이 이벤트는 블록 트리에서 "나쁜" 블록을 제거하기 위한 불필요한 최적화였습니다. 이 최적화는 PoS 합의가 그러한 나쁜 블록이나 그 후손에 대해 `POS_FORKCHOICE_UPDATED`를 보내지 않기 때문에 불필요했고, 결국 그러한 블록은 블록 트리의 대체 분기의 PoS 완료 이벤트 후에 제거될 수 있었습니다.
2. 이 이벤트는 블록이 두 개의 *다른* 충돌하는 PoS 분기에 의해 참조될 수 있기 때문에 일부 시나리오에서 위험했습니다. 따라서 동일한 블록에 대해 일부 시나리오에서 `POS_CONSENSUS_VALIDATED == TRUE` 및 `POS_CONSENSUS_VALIDATED == FALSE` 이벤트가 모두 전송될 수 있어 (1)의 최적화를 안전하게 수행하는 능력을 완전히 무효화합니다.

### EIP-2124 포크 식별자

EIP-2124의 `FORK_NEXT` 값은 주어진 노드가 알고 있는 다음 포크의 블록 번호를 참조하고 그렇지 않으면 `0`입니다.

`TRANSITION_BLOCK`의 번호는 전환 트리거 조건의 동적 특성을 감안할 때 미리 알 수 없습니다. 블록이 사전에 알려지지 않으므로 노드는 `FORK_NEXT`에 해당 번호를 사용할 수 없으며 이러한 사실을 감안하여 명시적으로 설정된 `FORK_NEXT_VALUE`가 대신 사용됩니다.

### 블록 가십 제거

합의 메커니즘 업그레이드 후 비콘 체인 네트워크만 블록을 검증하기에 충분한 정보를 갖게 됩니다. 따라서 `eth` 네트워크 프로토콜에 의해 제공되는 블록 가십은 안전하지 않게 되어 비콘 체인 네트워크에 존재하는 블록 가십을 위해 폐지됩니다.

클라이언트 소프트웨어는 P2P 구성 요소 처리 부하를 줄이고 알 수 없는 보안 속성을 가진 환경에서 작동을 중지하기 위해 터미널 PoW 블록의 후손을 전파하지 않는 것이 좋습니다.

### `extraData` 길이 제한

`extraData` 필드는 옐로우 페이퍼에서 최대 `32` 바이트로 정의됩니다. 따라서 메인넷과 대부분의 PoW 테스트넷은 값을 `32` 바이트로 제한합니다. 더 큰 길이의 `extraData` 필드는 특수 서명/합의 체계를 전달하기 위해 clique 테스트넷 및 기타 네트워크에서 사용됩니다. 이 EIP는 비콘 체인 PoS 합의 메커니즘으로 전환하는 모든 네트워크가 더 이상 확장되거나 무제한 `extraData`가 필요하지 않기 때문에 `extraData` 길이를 `32` 바이트로 제한합니다.

## 하위 호환성

이 EIP는 블록 유효성, 블록 보상 및 포크 선택 규칙에서 하위 비호환성을 도입합니다.

이 문서에 지정된 합의 업그레이드의 설계는 아래 [EVM](#evm) 섹션에 설명되거나 다른 방식으로 PoW 합의에 크게 의존하는 것을 제외하고 이더리움 위에 구축된 기존 애플리케이션 및 서비스에 대한 하위 비호환성을 도입하지 않습니다.

### EVM

이 EIP가 EVM에 명시적인 변경 사항을 도입하지는 않지만 기존 스마트 컨트랙트의 로직에 영향을 줄 수 있는 몇 가지 부분이 있습니다.

#### DIFFICULTY

`DIFFICULTY` 작업은 이 EIP가 발효되고 **`difficulty`** 필드를 `0` 상수로 교체하여 폐지한 후 항상 `0`을 반환합니다.

*참고:* 비콘 체인에 의해 축적된 랜덤성을 반환하도록 `DIFFICULTY` 의미를 변경하는 것이 고려 중이지만 별도의 EIP에서 도입될 것입니다.

#### BLOCKHASH

`BLOCKHASH` 작업의 출력으로 얻은 의사 난수는 이 EIP가 발효되고 블록 해시의 조작 가능성을 줄이는 PoW 메커니즘이 PoS로 대체된 후 더 불안전해집니다.

## 테스트 케이스

* 블록 유효성
  * `TRANSITION_BLOCK`부터 다음 중 하나라도 참이면 블록이 무효화됩니다:
    * `ommersHash != Keccak256(RLP([]))`
    * `difficulty != 0`
    * `nonce != 0x0000000000000000`
    * `len(extraData) > MAX_EXTRA_DATA_BYTES`
  * `TRANSITION_BLOCK`부터 블록 보상이 `beneficiary` 계정에 추가되지 않습니다
* 클라이언트 소프트웨어가 PoS LMD-GHOST 규칙을 준수합니다
  * 헤드 및 완료된 블록은 최근 `POS_FORKCHOICE_UPDATED` 이벤트에 따라 설정됩니다
  * `POS_FORKCHOICE_UPDATED` 이벤트가 수신되지 않으면 포크 선택 상태가 업데이트되지 않습니다
* 전환 프로세스
  * 클라이언트 소프트웨어는 터미널 PoW 블록 이후의 PoW 블록을 처리하지 않습니다
  * `TRANSITION_BLOCK`부터 클라이언트 소프트웨어는 새로운 블록 유효성 규칙을 적용합니다
  * 첫 번째 `POS_FORKCHOICE_UPDATED`부터 클라이언트 소프트웨어는 포크 선택 규칙을 PoS LMD-GHOST로 전환합니다
  * `TRANSITION_BLOCK`은 터미널 PoW 블록의 자식이어야 합니다
  * `FIRST_FINALIZED_BLOCK` 수신 후 `NewBlockHashes (0x01)` 및 `NewBlock (0x07)` 네트워크 메시지가 폐기됩니다

## 보안 고려사항

### 비콘 체인

[EIP-2982](./eip-2982.md#security-considerations)의 보안 고려사항 섹션을 참조하세요.

### 전환 프로세스

이 사양을 발효시키는 데 사용되는 전환 프로세스는 하드포크의 더 정교한 버전입니다 -- 이더리움 네트워크에서 하위 비호환 변경 사항을 적용하는 일반 절차입니다. 이 프로세스는 더 간단한 하드포크의 일반적인 블록 높이 포인트 조건 대신 여러 연속 단계를 가집니다.

이 업그레이드 프로세스의 복잡성은 이 포크가 합의 메커니즘 내의 실행 계층이 아닌 기본 합의 메커니즘을 대상으로 하기 때문입니다. 설계는 가능한 한 단순성을 추구하지만 이 전환 중 안전성 및 활성 고려 사항이 우선시되었습니다.

#### 터미널 총 난이도 vs 블록 번호

이 컨텍스트에서 하드포크에 미리 정의된 블록 번호를 사용하는 것은 전환 중 PoS 포크 선택이 우선권을 가지기 때문에 안전하지 않습니다.

공격자는 소수의 해시 파워를 사용하여 블록 높이 요구 사항을 충족하는 악의적인 체인 포크를 구축할 수 있습니다. 그런 다음 첫 번째 PoS 블록은 이 적대적 포크의 PoW 블록 위에 악의적으로 제안될 수 있으며, 헤드가 되어 전환의 보안을 전복시킬 수 있습니다.

이 공격 시나리오로부터 네트워크를 보호하기 위해 체인에 의해 축적된 난이도(총 난이도)가 업그레이드를 트리거하는 데 사용됩니다.

#### 터미널 PoW 블록 간 점프 능력

(일시적인) 네트워크 분할로 인해 대부분의 네트워크 참가자가 터미널 PoW 블록을 관찰하지 못하는 경우가 있을 수 있습니다. 이러한 경우 이 소수는 관찰한 소수 터미널 PoW 블록을 루트로 하는 PoS가 제공하는 새 규칙으로 포크 선택을 전환합니다.

전환 프로세스는 (a) 이러한 블록이 터미널 PoW 블록 조건을 충족하고 (b) `FIRST_FINALIZED_BLOCK`이 아직 수신되지 않은 한 다른 터미널 PoW 블록을 가진 포크 간에 네트워크가 재구성될 수 있도록 허용합니다. 이는 전환 프로세스 중 불리한 네트워크 조건에 대한 복원력을 제공하고 복구할 수 없는 포크/분할을 방지합니다.

#### PoW 블록 가져오기 중단

비콘 체인 네트워크에 연결된 클라이언트 소프트웨어 부분이 이더리움 네트워크가 `TERMINAL_TOTAL_DIFFICULTY`에 도달하기 전에 오프라인 상태가 되고 네트워크가 이 임계값을 충족하는 동안 오프라인 상태로 유지된다고 가정합니다. 이러한 이벤트는 클라이언트 소프트웨어가 PoS로 전환할 수 없게 하고 이 체인이 터미널 PoW 블록 이후에 구축되는 경우 PoW 체인을 계속 따를 수 있게 합니다. 비콘 체인 부분이 얼마나 오래 오프라인 상태였는지에 따라 다음과 같은 다양한 부정적인 영향이 발생할 수 있습니다:
* 클라이언트가 터미널 PoW 블록에 대한 post-state가 없어(상태가 정리됨) PoS 체인으로의 재구성을 수행하지 못하고 복구를 위해 처음부터 동기화하는 것만 옵션으로 남습니다.
* 애플리케이션, 사용자 또는 서비스가 잘못된 포크(계속 구축되는 PoW 체인)의 데이터를 사용하여 해당 측에서 보안 문제를 일으킬 수 있습니다.

터미널 PoW 블록 이후의 PoW 블록을 가져오지 않으면 소프트웨어 또는 구성 실패 시 활성 실패를 *선호하여* 안전성/재구성에 대한 이러한 부정적인 영향을 방지합니다.

#### 터미널 PoW 블록 재정의

비상 상황에서 합의 업그레이드를 가속화할 수 있는 메커니즘이 있습니다.
이 EIP는 가속화가 발효되는 다음 비상 사례 시나리오를 고려합니다:
* 업그레이드를 상당히 지연시키는 네트워크 해시레이트 감소.
* 업그레이드 전 PoW 네트워크에 대한 공격.

첫 번째 경우는 다음 매개변수를 업데이트하여 안전하게 가속화할 수 있습니다:
* `TERMINAL_TOTAL_DIFFICULTY` -- 원래 값보다 시간상 더 가까운 값으로 재설정합니다.
* `FORK_NEXT_VALUE` -- 그에 따라 조정합니다.

두 번째, 더 심각한 공격 시나리오는 더 침습적인 재정의가 필요합니다:
* `TERMINAL_BLOCK_HASH` -- 터미널 PoW 블록이 될 특정 블록의 해시로 설정합니다.
* `TERMINAL_BLOCK_NUMBER` -- `TERMINAL_BLOCK_HASH`에 의해 지정된 블록의 번호로 설정합니다.
* `TERMINAL_TOTAL_DIFFICULTY` -- `TERMINAL_BLOCK_HASH`에 의해 지정된 블록의 총 난이도 값으로 설정합니다.
* `FORK_NEXT_VALUE` -- 그에 따라 조정합니다.

*참고*: 두 번째 경우의 가속화는 이더리움 메인넷에서 중대한 활성 실패를 초래하기 때문에 가장 극단적인 시나리오에 대해 고려됩니다.

### 고대 블록은 더 이상 네트워크 보안의 필수 요건이 아님

PoW 네트워크에서 제네시스부터 시작하는 역사적 블록을 유지하는 것은 필수적입니다. 특정 체인에 속하는 모든 블록의 헤더는 PoW 봉인과 관련하여 이 체인의 유효성을 정당화하는 데 필요합니다.

체인의 전체 히스토리를 검증하는 것은 새로운 PoS 메커니즘에서 필요하지 않습니다. 대신 PoS 네트워크의 동기화 프로세스는 네트워크의 피어가 공유하는 역사적 스냅샷인 약한 주관성 체크포인트에 의존합니다. 이는 약한 주관성 체크포인트 이전의 역사적 블록이 더 이상 정식 블록체인을 결정하는 데 필수 요건이 아님을 의미합니다.

약한 주관성 체크포인트의 사양은 `ethereum/consensus-specs` 저장소에서 찾을 수 있습니다.

## 저작권
저작권 및 관련 권리는 [CC0](../LICENSE.md)를 통해 포기됩니다.
