---
eip: 4895
title: 작업으로서의 비콘 체인 푸시 출금
description: 새로운 "시스템 수준" 작업 유형을 통해 비콘 체인에서 EVM으로의 검증자 출금을 지원합니다.
author: Alex Stokes, Danny Ryan
status: Final
type: Standards Track
category: Core
created: 2022-03-10
lang: ko
original: https://github.com/ethereum/EIPs/blob/master/EIPS/eip-4895.md
---

## 요약

비콘 체인에서 EVM으로 "푸시"되는 검증자 출금을 지원하는 시스템 수준 "작업"을 도입합니다.

이러한 작업은 지정된 수신자에게 무조건적인 잔액 증가를 생성합니다.

## 동기

이 EIP는 비콘 체인에서 수행된 검증자 출금이 EVM으로 들어오는 방법을 제공합니다. 아키텍처는 "풀" 방식이 아닌 "푸시" 방식으로, 출금이 합의 레이어에서 큐에서 빠지는 즉시 실행 레이어에서 처리되어야 합니다.

출금은 실행 페이로드의 새로운 유형의 객체인 "작업"으로 표현됩니다. 이는 출금 기능을 사용자 수준 트랜잭션과 분리합니다. 이 접근 방식은 새로운 트랜잭션 유형을 도입하는 이전 접근 방식보다 더 복잡하지만, 이 "시스템 수준" 작업을 일반 트랜잭션과 깔끔하게 분리합니다.

이러한 분리는 이 시스템 수준 관심사를 사용자 데이터와 혼합하여 발생하는 상호작용 효과를 줄여 테스트를 단순화합니다(보안을 촉진).

## 명세

### 상수

| 상수 | 값 |
|-----|-----|
| `FORK_TIMESTAMP` | 1681338455 (Shanghai 하드포크) |

### 시스템 수준 작업: 출금

합의 레이어에서 검증된 출금을 설명하는 `withdrawal`이라는 새로운 페이로드 수준 객체를 정의합니다.

`Withdrawal`은 합의 레이어에서 주요 정보를 제공합니다:

1. **index**: 각 출금을 고유하게 식별하기 위해 0부터 시작하여 출금당 1씩 증가하는 `uint64` 값의 단조 증가 인덱스
2. **validator_index**: 출금에 해당하는 합의 레이어의 검증자 `uint64` 값
3. **address**: 출금된 이더를 받을 20바이트 수신자 주소
4. **amount**: Gwei(1e9 wei) 단위로 주어진 이더의 0이 아닌 `uint64` 값 금액

*참고*: 각 출금의 `index`는 전체 출금 시퀀스에 걸친 글로벌 카운터입니다.

`Withdrawal` 객체는 스키마에 따라 RLP 목록으로 직렬화됩니다:
```
[index, validator_index, address, amount]
```

### 실행 페이로드의 새 필드: withdrawals

실행 페이로드는 `Withdrawal` 데이터의 RLP 목록인 `withdrawals`에 대한 새 필드를 얻습니다:

```python
withdrawal_0 = [index_0, validator_index_0, address_0, amount_0]
withdrawal_1 = [index_1, validator_index_1, address_1, amount_1]
withdrawals = [withdrawal_0, withdrawal_1]
```

### 실행 페이로드 헤더의 새 필드: withdrawals root

실행 페이로드 헤더는 실행 페이로드의 `withdrawals`에 대한 커밋먼트를 얻는 새 필드를 얻습니다.

이 커밋먼트는 각 출금을 `withdrawals` 목록의 인덱스로 키잉된 Merkle-Patricia 트라이에 삽입하여 기존 실행 페이로드 헤더의 트랜잭션 루트와 동일하게 구성됩니다.

```python
def compute_trie_root_from_indexed_data(data):
    trie = Trie.from([(i, obj) for i, obj in enumerate(data)])
    return trie.root

execution_payload_header.withdrawals_root = compute_trie_root_from_indexed_data(execution_payload.withdrawals)
```

### 실행 페이로드 유효성

실행 페이로드가 올바른 형식이라고 가정하면, 실행 클라이언트는 `withdrawals_root`가 페이로드의 목록을 고려한 예상 값과 일치하는지 확인하는 추가 페이로드 유효성 검사를 수행합니다.

```python
assert execution_payload_header.withdrawals_root == compute_trie_root_from_indexed_data(execution_payload.withdrawals)
```

### 상태 전환

실행 페이로드의 `withdrawals`는 사용자 수준 트랜잭션이 적용된 **후에** 처리됩니다.

`execution_payload.withdrawals` 목록의 각 `withdrawal`에 대해, 구현은 지정된 `amount`만큼 `address`의 잔액을 증가시킵니다.

`amount`는 Gwei 단위로 주어지므로 실행 상태의 계정 잔액으로 작업할 때 wei 단위로 변환해야 합니다.

이 잔액 변경은 무조건적이며 **반드시** 실패해서는 안 됩니다.

이 작업에는 관련 가스 비용이 없습니다.

## 근거

### 왜 새로운 트랜잭션 유형이 아닌가?

이 EIP는 기존 EVM 트랜잭션 유형과 다른 특별한 의미를 가지므로 새로운 유형의 객체인 "출금 작업"을 제안합니다.

작업은 일반적인 트랜잭션처럼 최종 사용자가 아닌 전체 시스템에 의해 시작됩니다.

완전히 새로운 유형의 객체는 테스트를 단순화하고 보안 검토를 용이하게 하기 위해 일반 EVM 실행을 이 유형의 처리와 방화벽으로 분리합니다.

### 왜 출금 유형에 (가스) 비용이 없는가?

주어진 시간에 실행 레이어에 도달할 수 있는 최대 출금 수는 합의 레이어에 의해 제한되며, 이 제한은 더 넓은 페이로드 실행의 맥락에서 실행 레이어 운영 비용이 무시할 수 있도록 선택되었습니다.

이 제한은 계산 비용(상태에서 몇 번의 잔액 업데이트만)과 스토리지/네트워킹 비용(추가 페이로드 발자국이 작게 유지됨) 모두에 적용됩니다(현재 매개변수화는 추가 오버헤드를 현재 평균 페이로드 크기의 약 1%로 유지).

### 왜 잔액 업데이트만? 일반 EVM 실행은 없는가?

더 일반적인 처리는 실패 위험을 도입하며, 이는 비콘 체인의 회계를 복잡하게 합니다.

이 EIP는 (복잡성) 비용을 최소화하면서 대부분의 이점을 제공하는 출금 경로를 제안합니다.

## 역호환성

문제 없습니다. 하드포크가 필요합니다.

## 보안 고려사항

출금 트랜잭션의 합의 레이어 검증은 적절한 양의 ETH가 실행 레이어로 다시 출금되도록 하는 데 중요합니다. 이 합의 레이어에서 실행 레이어로의 ETH 전송은 EVM에서 현재 유사한 것이 없으므로 매우 높은 보안 검토가 필요합니다.

## 저작권

저작권 및 관련 권리는 CC0를 통해 포기되었습니다.
