---
eip: 778
title: 이더리움 노드 레코드 (ENR)
author: Felix Lange <fjl@ethereum.org>
type: Standards Track
category: Networking
status: Final
created: 2017-11-23
discussions-to: https://github.com/ethereum/devp2p/issues/43
lang: ko
original: ../eip-778.md
---

# 요약

이 EIP는 P2P 연결 정보를 위한 개방형 포맷인 이더리움 노드 레코드(Ethereum Node Records)를 정의합니다.

# 동기

이더리움 노드들은 노드 발견 프로토콜을 통해 서로를 찾습니다. 이 프로토콜의 목적은 노드 ID 공개키(secp256k1 곡선), IP 주소, 그리고 두 개의 포트 번호를 중계하는 것입니다. 다른 정보는 중계할 수 없습니다.

이 명세서는 연결 관련 정보를 위한 유연한 포맷인 *노드 레코드*를 정의함으로써 발견 v4 프로토콜의 제한을 해소하고자 합니다. 노드 레코드는 노드 발견 프로토콜의 향후 버전을 통해 중계될 수 있습니다. 또한 DNS, ENS, devp2p 서브프로토콜 등 임의의 다른 메커니즘을 통해서도 중계될 수 있습니다.

노드 레코드는 암호화 민첩성과 프로토콜 업그레이드 처리를 개선합니다. 레코드는 임의의 전송 프로토콜과 그에 연관된 공개키 자료에 대한 정보를 포함할 수 있습니다.

새 포맷의 또 다른 목표는 연결 정보의 권위 있는 업데이트를 제공하는 것입니다. 노드가 엔드포인트를 변경하고 새 레코드를 게시하면, 다른 노드들은 어떤 레코드가 더 새로운 것인지 판별할 수 있어야 합니다.

# 명세

노드 레코드의 구성 요소는 다음과 같습니다:

- `signature`: 레코드 내용의 암호화 서명
- `seq`: 시퀀스 번호, 64비트 부호 없는 정수. 노드는 레코드가 변경될 때마다 이 번호를 증가시키고 레코드를 재게시해야 합니다.
- 레코드의 나머지는 임의의 키/값 쌍으로 구성됩니다.

레코드의 서명은 *신원 체계(identity scheme)*에 따라 생성되고 검증됩니다. 신원 체계는 DHT에서 노드의 주소를 파생하는 것도 담당합니다.

키/값 쌍은 키 기준으로 정렬되어야 하며 고유해야 합니다. 즉, 어떤 키든 한 번만 나타날 수 있습니다. 키는 기술적으로 임의의 바이트 시퀀스가 될 수 있지만, ASCII 텍스트가 권장됩니다. 아래 표의 키 이름들은 미리 정의된 의미를 갖습니다.

| 키          | 값                                         |
|:------------|:-------------------------------------------|
| `id`        | 신원 체계 이름, 예: "v4"                    |
| `secp256k1` | 압축된 secp256k1 공개키, 33바이트           |
| `ip`        | IPv4 주소, 4바이트                          |
| `tcp`       | TCP 포트, 빅 엔디언 정수                    |
| `udp`       | UDP 포트, 빅 엔디언 정수                    |
| `ip6`       | IPv6 주소, 16바이트                         |
| `tcp6`      | IPv6 전용 TCP 포트, 빅 엔디언 정수          |
| `udp6`      | IPv6 전용 UDP 포트, 빅 엔디언 정수          |

`id`를 제외한 모든 키는 선택사항이며, IP 주소와 포트도 포함됩니다. 엔드포인트 정보가 없는 레코드도 서명이 유효하다면 여전히 유효합니다. `tcp6` / `udp6` 포트가 제공되지 않으면, `tcp` / `udp` 포트가 두 IP 주소 모두에 적용됩니다. `tcp`, `tcp6` 또는 `udp`, `udp6`에서 동일한 포트 번호를 선언하는 것은 피해야 하지만, 레코드를 무효화하지는 않습니다.

### RLP 인코딩

노드 레코드의 정규 인코딩은 `[signature, seq, k, v, ...]`의 RLP 목록입니다. 노드 레코드의 최대 인코딩 크기는 300바이트입니다. 구현체는 이 크기를 초과하는 레코드를 거부해야 합니다.

레코드는 다음과 같이 서명되고 인코딩됩니다:

    content   = [seq, k, v, ...]
    signature = sign(content)
    record    = [signature, seq, k, v, ...]

### 텍스트 인코딩

노드 레코드의 텍스트 형식은 RLP 표현의 base64 인코딩에 `enr:` 접두사를 붙인 것입니다. 구현체는 [URL-safe base64 알파벳][base64url]을 사용하고 패딩 문자를 생략해야 합니다.

### "v4" 신원 체계

이 명세서는 다른 체계가 추가적인 EIP에 의해 정의될 때까지 기본값으로 사용될 단일 신원 체계를 정의합니다. "v4" 체계는 노드 발견 v4에서 사용하는 암호화 시스템과 역호환됩니다.

- 이 체계로 레코드 `content`에 서명하려면, `content`에 keccak256 해시 함수(EVM에서 사용하는 것과 동일)를 적용한 다음, 해시의 서명을 생성합니다. 결과로 나오는 64바이트 서명은 `r`과 `s` 서명 값의 연결로 인코딩됩니다(복구 ID `v`는 생략됩니다).
- 레코드를 검증하려면, 서명이 레코드의 "secp256k1" 키/값 쌍의 공개키로 만들어졌는지 확인합니다.
- 노드 주소를 파생하려면, 압축되지 않은 공개키의 keccak256 해시를 취합니다.

# 근거

이 포맷은 두 가지 방식으로 미래의 필요를 충족하도록 설계되었습니다:

- 새 키/값 쌍 추가: 이것은 항상 가능하며 구현 합의가 필요하지 않습니다. 기존 클라이언트는 내용을 해석할 수 있는지 여부와 관계없이 모든 키/값 쌍을 수락합니다.
- 신원 체계 추가: 네트워크가 그렇지 않으면 서명을 수락하지 않으므로 구현 합의가 필요합니다. 새 신원 체계를 도입하려면 EIP를 제안하고 구현되도록 하세요. 대부분의 클라이언트가 수락하는 즉시 체계를 사용할 수 있습니다.

레코드 크기는 레코드가 자주 중계되고 DNS와 같이 크기가 제한된 프로토콜에 포함될 수 있기 때문에 제한됩니다. "v4" 체계를 사용하여 서명된 IPv4 주소를 포함하는 레코드는 대략 120바이트를 차지하여, 추가 메타데이터를 위한 충분한 공간을 남깁니다.

IP 주소와 포트와 관련된 많은 사전 정의된 키가 필요한 이유가 궁금할 수 있습니다. 이 필요성은 주거용 및 모바일 네트워크 설정이 종종 IPv4를 NAT 뒤에 두는 반면, IPv6 트래픽은(지원되는 경우) 동일한 호스트로 직접 라우팅되기 때문에 발생합니다. 두 주소 유형을 모두 선언하면 IPv4만 지원하는 위치와 두 프로토콜을 모두 지원하는 위치에서 노드에 접근할 수 있습니다.

# 테스트 벡터

IPv4 주소 `127.0.0.1`과 UDP 포트 `30303`을 포함하는 예제 레코드입니다.
노드 ID는 `a448f24c6d18e575453db13171562b71999873db5b286df957af199ec94617f7`입니다.

```text
enr:-IS4QHCYrYZbAKWCBRlAy5zzaDZXJBGkcnh4MHcBFZntXNFrdvJjX04jRzjzCBOonrkTfj499SZuOh8R33Ls8RRcy5wBgmlkgnY0gmlwhH8AAAGJc2VjcDI1NmsxoQPKY0yuDUmstAHYpMa2_oxVtw0RW_QAdpzBQA8yWM0xOIN1ZHCCdl8
```

레코드는 시퀀스 번호 `1`과 다음 개인키를 사용하여 "v4" 신원 체계로 서명되었습니다:

```text
b71c71a67e1177ad4e901695e1b4b9ee17ae16c6668d313eac2f96dbcda3f291
```

레코드의 RLP 구조:

```text
[
  7098ad865b00a582051940cb9cf36836572411a47278783077011599ed5cd16b76f2635f4e234738f30813a89eb9137e3e3df5266e3a1f11df72ecf1145ccb9c,
  01,
  "id",
  "v4",
  "ip",
  7f000001,
  "secp256k1",
  03ca634cae0d49acb401d8a4c6b6fe8c55b70d115bf400769cc1400f3258cd3138,
  "udp",
  765f,
]
```

# 저작권

저작권 및 관련 권리는 [CC0](../LICENSE.md)를 통해 포기되었습니다.

[base64url]: https://tools.ietf.org/html/rfc4648#section-5
