---
eip: 165
title: 표준 인터페이스 감지
author: Christian Reitwießner, Nick Johnson, Fabian Vogelsteller, Jordi Baylina, Konrad Feldmeier, William Entriken
status: Final
type: Standards Track
category: ERC
created: 2018-01-23
lang: ko
original: https://github.com/ethereum/ERCs/blob/master/ERCS/erc-165.md
---

## 요약

ERC-165는 다음을 위한 표준화된 절차를 수립합니다:
1. 인터페이스 식별 방법
2. 컨트랙트가 인터페이스 지원을 광고하는 방법
3. ERC-165 준수 여부를 감지하는 방법
4. 특정 인터페이스 구현 여부를 질의하는 방법

## 동기

ERC-20과 같은 표준 인터페이스는 감지 메커니즘의 이점을 얻습니다. 기대치를 하드코딩하는 대신, 시스템은 상호작용 전에 컨트랙트가 특정 인터페이스를 지원하는지 질의하고 호환성 버전을 결정하는 방법이 필요합니다.

## 명세

### 인터페이스 식별

인터페이스는 이더리움 ABI 명세에 따른 함수 셀렉터로 구성됩니다. 인터페이스 식별자는 모든 함수 셀렉터를 XOR하여 파생됩니다. 이는 해당 인터페이스를 나타내는 고유한 bytes4 값을 생성합니다.

```solidity
interface Solidity101 {
    function hello() external pure;
    function world(int) external pure;
}

// 인터페이스 ID 계산
bytes4 interfaceId = bytes4(keccak256('hello()')) ^ bytes4(keccak256('world(int256)'));
```

ERC-165 인터페이스 자체의 식별자는 `0x01ffc9a7`이며, `supportsInterface(bytes4)` 함수 시그니처에서 계산됩니다.

### 인터페이스 지원 게시

준수하는 컨트랙트는 다음을 구현합니다:

```solidity
interface ERC165 {
    /// @notice 컨트랙트가 인터페이스를 구현하는지 질의
    /// @param interfaceID ERC-165에 지정된 인터페이스 식별자
    /// @dev 인터페이스 식별은 ERC-165에 지정되어 있습니다.
    ///  이 함수는 30,000 가스 미만을 사용합니다.
    /// @return 컨트랙트가 `interfaceID`를 구현하고
    ///  `interfaceID`가 0xffffffff가 아니면 `true`, 그렇지 않으면 `false`
    function supportsInterface(bytes4 interfaceID) external view returns (bool);
}
```

이 함수는:
- `0x01ffc9a7` (ERC-165 자체)에 대해 `true` 반환
- `0xffffffff`에 대해 `false` 반환
- 구현된 인터페이스에 대해 `true` 반환
- 30,000 가스 내에서 완료

### 감지 절차

**ERC-165 준수 감지:**
1. `supportsInterface(0x01ffc9a7)`이 true를 반환하는지 STATICCALL로 확인
2. `supportsInterface(0xffffffff)`가 false를 반환하는지 확인

**특정 인터페이스 감지:**
1. 먼저 ERC-165 지원 확인
2. 원하는 인터페이스에 대해 `supportsInterface(interfaceID)` 호출

### 감지 의사 코드

```solidity
function doesContractImplementInterface(address _contract, bytes4 _interfaceId)
    internal view returns (bool)
{
    uint256 success;
    uint256 result;

    (success, result) = noThrowCall(_contract,
        abi.encodeWithSelector(0x01ffc9a7, 0x01ffc9a7)); // ERC165 지원 확인
    if ((success == 0) || (result == 0)) {
        return false;
    }

    (success, result) = noThrowCall(_contract,
        abi.encodeWithSelector(0x01ffc9a7, 0xffffffff)); // 무효 ID 확인
    if ((success == 0) || (result != 0)) {
        return false;
    }

    (success, result) = noThrowCall(_contract,
        abi.encodeWithSelector(0x01ffc9a7, _interfaceId)); // 특정 인터페이스 확인
    if ((success == 1) && (result == 1)) {
        return true;
    }
    return false;
}
```

## 구현 접근 방식

두 가지 일반적인 패턴이 있습니다:

### 매핑 기반
인터페이스 지원을 매핑에 저장합니다.

```solidity
mapping(bytes4 => bool) private _supportedInterfaces;

constructor() {
    _registerInterface(0x01ffc9a7); // ERC165
}

function supportsInterface(bytes4 interfaceId) external view returns (bool) {
    return _supportedInterfaces[interfaceId];
}

function _registerInterface(bytes4 interfaceId) internal {
    require(interfaceId != 0xffffffff, "Invalid interface id");
    _supportedInterfaces[interfaceId] = true;
}
```

- 초기화 비용이 높음 (인터페이스당 20,000 가스)
- 질의 비용이 일정 (586 가스)

### 순수 함수 기반
조건 로직을 통해 지원을 계산합니다.

```solidity
function supportsInterface(bytes4 interfaceId) external pure returns (bool) {
    return interfaceId == 0x01ffc9a7  // ERC165
        || interfaceId == 0x80ac58cd  // ERC721
        || interfaceId == 0x5b5e139f; // ERC721Metadata
}
```

- 초기화 비용이 낮음
- 지원되는 인터페이스에 따라 질의 비용이 선형 증가

## 알려진 인터페이스

| 인터페이스 ID | 표준 |
|-------------|------|
| `0x01ffc9a7` | ERC-165 (이 표준) |
| `0x80ac58cd` | ERC-721 (NFT) |
| `0x5b5e139f` | ERC-721 메타데이터 |
| `0x780e9d63` | ERC-721 열거 |
| `0xd9b67a26` | ERC-1155 (멀티 토큰) |
| `0x0e89341c` | ERC-1155 메타데이터 URI |

## 역호환성

이 명세는 현재 이더리움 위에서 구축할 수 있으며 기존 표준에 영향을 미치지 않습니다.

## 저작권

저작권 및 관련 권리는 CC0를 통해 포기되었습니다.
