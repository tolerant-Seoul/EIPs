---
eip: 4337
title: 대체 멤풀을 사용한 계정 추상화
author: Vitalik Buterin, Yoav Weiss, Dror Tirosh, Shahaf Nacson, Alex Forshtat, Kristof Gazso, Tjaden Hess
status: Final
type: Standards Track
category: ERC
created: 2021-09-29
lang: ko
original: https://github.com/ethereum/ERCs/blob/master/ERCS/erc-4337.md
---

## 요약

ERC-4337은 합의 계층 프로토콜 변경 없이 이더리움에서 계정 추상화를 가능하게 하는 표준 제안입니다. 핵심 이더리움 프로토콜을 수정하는 대신, 별도의 멤풀을 통해 처리되는 "UserOperation"을 사용하는 상위 계층 인프라를 도입합니다.

## 동기

계정 추상화의 목표는 사용자가 외부 소유 계정(EOA) 없이 스마트 컨트랙트 계정만으로 운영할 수 있게 하는 것입니다. 이를 통해 다음과 같은 사용 사례를 지원합니다:

- 프라이버시 보존 애플리케이션
- 원자적 다중 작업
- ERC-20 토큰 기반 수수료 지불
- 소셜 복구 및 다중 서명 지갑
- 가스 후원(스폰서십)

## 핵심 구성 요소

### UserOperation 구조

사용자는 스마트 컨트랙트 계정이 수행할 작업을 `UserOperation`이라는 구조체에 패키징합니다. 이 의사 트랜잭션 객체는 다음 필드를 포함합니다:

| 필드 | 설명 |
|------|------|
| `sender` | 작업을 수행하는 계정 주소 |
| `nonce` | 재전송 방지를 위한 논스 |
| `factory` | 계정 생성 시 사용할 팩토리 주소 |
| `factoryData` | 팩토리에 전달할 데이터 |
| `callData` | 실행할 호출 데이터 |
| `callGasLimit` | 실행 단계 가스 한도 |
| `verificationGasLimit` | 검증 단계 가스 한도 |
| `preVerificationGas` | 번들러 보상용 가스 |
| `maxFeePerGas` | 최대 가스 가격 |
| `maxPriorityFeePerGas` | 최대 우선순위 수수료 |
| `paymaster` | 가스를 대신 지불할 페이마스터 주소 |
| `paymasterData` | 페이마스터에 전달할 데이터 |
| `signature` | 계정 검증용 서명 |

### EntryPoint 컨트랙트

싱글톤 EntryPoint 컨트랙트는 중앙 실행 허브 역할을 합니다. UserOperation 번들을 두 개의 순차적 루프를 통해 처리합니다:

1. **검증 단계**: 서명이 유효한지, 수수료가 지불되었는지 확인
2. **실행 단계**: 실제 작업 실행

시뮬레이션의 목적은 "UserOperation의 온체인 검증 코드가 샌드박스화되어 동일한 번들의 다른 UserOperation들로부터 격리되도록" 하는 것입니다.

### 번들러(Bundler)

번들러는 전용 멤풀에서 UserOperation을 수집하고 이를 표준 이더리움 트랜잭션으로 패키징하여 블록에 포함시키는 특수 노드입니다. 제출 전에 검증과 시뮬레이션을 수행합니다.

핵심 원칙:
- 어떤 번들러든 참여할 수 있어 탈중앙화 유지
- 이더리움 합의 수정 불필요
- DoS 공격 방지를 위한 평판 시스템

### 페이마스터(Paymaster)

페이마스터는 트랜잭션을 후원할 수 있는 선택적 컨트랙트입니다:

- 개발자가 사용자 수수료를 보조
- 토큰 기반 지불 허용
- 애플리케이션별 수수료 구조 지원

## 검증 프레임워크

UserOperation은 3단계 검증 과정을 거칩니다:

1. **초기 멤풀 수락**: 기본 형식 검증
2. **번들 준비 검증**: 시뮬레이션 및 충돌 검사
3. **최종 온체인 검증**: 실제 실행 전 최종 확인

## 보안 아키텍처

설계는 보안 책임을 감사된 EntryPoint 컨트랙트에 집중시키면서 개별 계정 검증 로직은 최소화합니다. 다음을 포함합니다:

- 포괄적인 스토리지 접근 규칙
- 악의적 엔티티로부터의 서비스 거부 공격 방지를 위한 평판 시스템
- 번들러와 계정 간 명확한 책임 분리

## 근거

### 왜 별도의 멤풀인가?

기존 트랜잭션 멤풀을 사용하면 합의 계층 변경이 필요합니다. 별도의 UserOperation 멤풀을 사용함으로써:
- 프로토콜 업그레이드 없이 배포 가능
- 점진적 채택 허용
- 기존 인프라와 호환성 유지

### 왜 EntryPoint 싱글톤인가?

단일 EntryPoint를 사용함으로써:
- 보안 감사를 한 곳에 집중
- 생태계 전반의 상호운용성 보장
- 업그레이드 경로 단순화

## 역호환성

ERC-4337은 기존 이더리움 작업에 영향을 주지 않는 완전히 새로운 기능을 도입합니다. EOA는 계속 정상적으로 작동하며, 스마트 컨트랙트 계정은 선택적으로 이 표준을 채택할 수 있습니다.

## 저작권

저작권 및 관련 권리는 CC0를 통해 포기되었습니다.
