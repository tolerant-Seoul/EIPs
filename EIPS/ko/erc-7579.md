---
eip: 7579
title: 최소 모듈러 스마트 계정
author: zeroknots, Konrad Kopp, Taek Lee, Fil Makarov, Elim Poon, Lyu Min
status: Draft
type: Standards Track
category: ERC
created: 2023-12-14
requires: 165, 1271, 2771, 4337
lang: ko
original: https://github.com/ethereum/ERCs/blob/master/ERCS/erc-7579.md
---

## 요약

이 표준은 모듈러 스마트 계정과 관련 모듈이 생태계 전반의 상호운용성을 달성하기 위한 최소한의 인터페이스를 수립합니다. 계정의 경우 ERC-165 및 ERC-1271 준수를 요구하면서 실행, 구성 및 폴백 메커니즘을 지정합니다. 모듈의 경우 핵심 인터페이스를 정의하고 기능 유형별로 분류합니다.

## 동기

스마트 계정 생태계는 구현이 아키텍처에서 크게 다르기 때문에 파편화에 직면해 있습니다. 현재의 다양성은 여러 문제를 야기합니다:

- **벤더 종속**: 사용자가 특정 계정 구현에 의존하게 됨
- **모듈 비호환성**: 한 계정용으로 설계된 모듈이 다른 계정에서 거의 작동하지 않음
- **지갑 생태계 부담**: 다양한 지갑 애플리케이션이 호환성 레이어를 유지하는 데 어려움

이 표준은 구현 전반의 혁신 역량을 보존하면서 "스마트 계정과 모듈 간의 상호운용성을 허용하는 최소한의 인터페이스"를 수립하는 것을 목표로 합니다.

## 계정 요구사항

### 실행 인터페이스

계정은 다음을 구현해야 합니다:

```solidity
// 일반 실행
function execute(bytes32 mode, bytes calldata executionCalldata) external;

// 모듈에서 시작된 트랜잭션
function executeFromExecutor(bytes32 mode, bytes calldata executionCalldata)
    external returns (bytes[] memory);
```

### 구성 인터페이스

필수 함수:
- `accountId()`: 식별용
- `supportsExecutionMode(bytes32 mode)`: 기능 선언
- `supportsModule(uint256 moduleTypeId)`: 모듈 타입 검증

### 모듈 관리

```solidity
// 모듈 설치
function installModule(
    uint256 moduleTypeId,
    address module,
    bytes calldata initData
) external;

// 모듈 제거
function uninstallModule(
    uint256 moduleTypeId,
    address module,
    bytes calldata deInitData
) external;

// 설치 여부 확인
function isModuleInstalled(
    uint256 moduleTypeId,
    address module,
    bytes calldata additionalContext
) external view returns (bool);
```

### 실행 모드 인코딩

실행 모드는 32바이트 구조로 구성됩니다:

| 바이트 | 용도 |
|--------|------|
| 1 바이트 | 호출 유형 (단일 호출, 배치, staticcall, delegatecall) |
| 1 바이트 | 실행 유형 (실패 시 되돌리기 vs 오류 처리 모드) |
| 4 바이트 | 향후 표준화를 위해 예약 |
| 4 바이트 | 사용자 정의 모드 셀렉터 |
| 22 바이트 | 모드별 페이로드 데이터 |

## 모듈 카테고리

표준은 고유 식별자를 가진 네 가지 모듈 유형을 식별합니다:

### 타입 1: 검증자 (Validators)
검증 단계에서 트랜잭션 유효성을 결정합니다.

```solidity
function validateUserOp(UserOperation calldata userOp, bytes32 userOpHash)
    external returns (uint256);
```

### 타입 2: 실행자 (Executors)
콜백 메커니즘을 통해 트랜잭션을 실행합니다.

```solidity
function execute(bytes calldata data) external returns (bytes memory);
```

### 타입 3: 폴백 핸들러 (Fallback Handlers)
폴백 기능을 확장합니다.

### 타입 4: 훅 (Hooks)
트랜잭션 전/후에 사용자 정의 로직을 실행합니다.

```solidity
function preCheck(address sender, bytes calldata data)
    external returns (bytes memory);

function postCheck(bytes calldata hookData) external;
```

### 모든 모듈의 필수 함수

```solidity
interface IModule {
    function onInstall(bytes calldata data) external;
    function onUninstall(bytes calldata data) external;
    function isModuleType(uint256 moduleTypeId) external view returns (bool);
}
```

## ERC-1271 통합

계정은 검증 로직을 직접 구현하는 대신 검증자에게 서명 검증 요청을 전달해야 합니다:

```solidity
function isValidSignatureWithSender(
    address sender,
    bytes32 hash,
    bytes calldata signature
) external view returns (bytes4);
```

## 폴백 핸들러 요구사항

구현 시 폴백 핸들러는:
- 호출에 `call` 또는 `staticcall` 사용
- 원본 호출자 컨텍스트를 보존하기 위해 ERC-2771 메커니즘 사용
- 함수 셀렉터에 기반하여 요청 라우팅
- 훅을 통한 선택적 승인 제어 구현

## 설계 근거

### 최소 철학

엄격한 아키텍처 요구사항을 부과하는 대신, 표준은 기본 상호운용성을 수립하면서 경쟁 구현에 대한 유연성을 보존합니다. 이 접근 방식은 프로덕션 스마트 계정 경험과 검증된 상호운용성 패턴에서 도출됩니다.

### 실행 모드 인코딩의 이점

다양한 실행 패턴을 단일 매개변수화된 함수로 통합하면 예약된 바이트를 통해 향후 확장을 지원하면서 코드 복잡성을 줄입니다. 이 전략은 함수 변형의 확산을 방지합니다.

### 모듈 타입 차별화

모듈 타입을 구분하면 검증자 권한이 실수로 실행 권한을 부여할 수 있는 승인 우회 취약점을 방지합니다.

### ERC-4337 의존성

표준은 현재 ERC-4337 호환성을 가정합니다. 그러나 저자들은 다른 블록체인 플랫폼에서 대체 계정 추상화 구현이 등장함에 따라 선택적 ERC-4337 지원으로의 마이그레이션을 예상합니다.

## 역호환성

배포된 스마트 계정은 프록시 업그레이드를 통해 이 표준을 구현할 수 있습니다. 업그레이드 불가능한 컨트랙트는 아키텍처에서 지원하는 경우 호환되는 폴백 핸들러를 추가하여 준수를 달성할 수 있습니다.

## 보안 고려사항

주요 위험 영역:

- **Delegatecall 취약점**: 계정은 악용 방지를 위해 대상 안전성을 보장해야 함
- **모듈 콜백 위험**: 설치/제거 콜백이 재진입 공격을 가능하게 할 수 있음; 방어 조치 권장
- **승인 격차**: 폴백 핸들러는 강력한 권한 제어 필요
- **훅 서비스 거부**: 사전/사후 검사에서 되돌리는 악의적인 훅이 계정을 동결시킬 수 있음
- **구성 중첩**: 자체 호출을 통한 승인 우회는 신중한 구현 필요

## ERC-6900과의 비교

| 측면 | ERC-6900 | ERC-7579 |
|------|----------|----------|
| 접근 방식 | 포괄적 프레임워크 | 최소 인터페이스 |
| 복잡성 | 높음 | 낮음 |
| 유연성 | 구조화됨 | 개방적 |
| 모듈 타입 | 3가지 (검증, 실행, 훅) | 4가지 (검증자, 실행자, 폴백, 훅) |

두 표준 모두 모듈러 스마트 계정을 목표로 하지만, ERC-7579는 더 가벼운 접근 방식을 취합니다.

## 저작권

저작권 및 관련 권리는 CC0를 통해 포기되었습니다.
