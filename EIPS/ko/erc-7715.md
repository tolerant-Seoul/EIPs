---
eip: 7715
title: 지갑에서 권한 부여
author: Moody Salem, Dan Finlay, Derek Chiang, Jake Moxey
status: Draft
type: Standards Track
category: ERC
created: 2024-05-24
requires: 4337, 5792, 7679, 7710
lang: ko
original: https://github.com/ethereum/ERCs/blob/master/ERCS/erc-7715.md
---

## 요약

이 제안은 DApp이 지갑에 범위가 지정된 권한을 요청하여 사용자를 대신하여 트랜잭션을 실행할 수 있도록 하는 새로운 JSON-RPC 메서드 `wallet_grantPermissions`를 도입합니다. 이 표준은 연결되지 않은 사용자를 위한 트랜잭션 실행과 연결된 사용자를 위한 권한 범위 트랜잭션이라는 두 가지 주요 사용 사례를 다룹니다.

## 동기

현재 지갑 상호작용은 사용자가 각 트랜잭션을 수동으로 승인해야 하므로, 높은 상호작용이 필요한 애플리케이션에서 마찰을 일으킵니다. 또한 지갑 간 기존 세션 키 구현이 표준화되어 있지 않아 DApp이 권한을 균일하게 요청할 수 없습니다.

이 명세는 다음을 통해 이러한 제한을 해결하는 것을 목표로 합니다:

- **트랜잭션 승인 피로 감소**: 일괄 처리 또는 사전 승인된 작업을 통한 사용자 경험 개선
- **오프라인 트랜잭션 실행 지원**: 구독, 자동화된 거래, 지정가 주문 등
- **벤더 중립적 세션 키 관리**: 지갑 구현 전반에 걸친 표준화

## 명세

### wallet_grantPermissions 메서드

#### 요청 스키마 - PermissionRequest

| 필드 | 타입 | 설명 |
|------|------|------|
| `chainId` | Hex | EIP-155 체인 식별자 |
| `address` | Address (선택) | 대상 계정 주소 |
| `expiry` | number | 세션 만료 Unix 타임스탬프 |
| `signer` | object | 서명자 유형과 데이터 |
| `permissions` | array | 권한 객체 배열 |

#### 서명자 유형

| 유형 | 설명 |
|------|------|
| `wallet` | 지갑 자체가 세션 관리 |
| `key` | 단일 암호화 키 (secp256r1, secp256k1, ed25519, schnorr) |
| `keys` | 다중 키/멀티시그 구성 |
| `account` | 위임 권한이 부여된 다른 계정 (ERC-7710) |

#### 권한 유형

다음과 같은 권한 유형이 정의됩니다:

```typescript
interface Permission {
  type: string;           // 권한 유형
  data: object;           // 유형별 데이터
  policies: Policy[];     // 정책 제약 조건
}
```

**지원되는 권한 유형**:
- `native-token-transfer`: 네이티브 토큰 전송 (한도 설정 가능)
- `erc20-token-transfer`: ERC-20 토큰 전송
- `erc721-token-transfer`: ERC-721 NFT 전송
- `erc1155-token-transfer`: ERC-1155 토큰 전송

**정책 유형**:
- `token-allowance`: 토큰 한도 제한
- `gas-limit`: 가스 한도 제한
- `call-count`: 호출 횟수 제한
- `rate-limit`: 속도 제한 (간격당 횟수)

#### 예시 요청

```json
{
  "method": "wallet_grantPermissions",
  "params": [{
    "chainId": "0x1",
    "expiry": 1716480000,
    "signer": {
      "type": "key",
      "data": {
        "type": "secp256r1",
        "publicKey": "0x..."
      }
    },
    "permissions": [{
      "type": "erc20-token-transfer",
      "data": {
        "tokenAddress": "0xA0b86a33E6417C8cA..."
      },
      "policies": [{
        "type": "token-allowance",
        "data": { "allowance": "1000000000" }
      }, {
        "type": "rate-limit",
        "data": { "count": 1, "interval": 2592000 }
      }]
    }]
  }]
}
```

### 응답 스키마 - PermissionResponse

지갑은 요청된 매개변수와 함께 다음을 반환합니다:

| 필드 | 타입 | 설명 |
|------|------|------|
| `context` | Hex | 권한 취소 및 제출을 위한 불투명 식별자 |
| `accountMeta` | object (선택) | 계정이 배포되지 않은 경우 팩토리 및 배포 데이터 (ERC-4337) |
| `signerMeta` | object (선택) | 서명자 유형별 빌더 또는 위임 관리자 주소 |

```typescript
interface PermissionResponse {
  grantedPermissions: PermissionRequest;
  context: Hex;
  accountMeta?: {
    factory: Address;
    factoryData: Hex;
  };
  signerMeta?: {
    userOpBuilder?: Address;      // key 유형
    delegationManager?: Address;  // account 유형
  };
}
```

### wallet_revokePermissions 메서드

`permissionContext` 16진수 문자열을 받아 관련 권한을 취소하고, 성공 시 빈 응답을 반환합니다.

```json
{
  "method": "wallet_revokePermissions",
  "params": [{
    "permissionContext": "0x..."
  }]
}
```

## 통합 패턴

### ERC-7679 (UserOp 빌더)와 통합

키 유형 서명자의 경우, 반환된 `userOpBuilder` 주소와 `permissionsContext`를 통해 DApp이 권한 제약이 포함된 ERC-4337 UserOperation을 구성할 수 있습니다.

```typescript
// UserOp 구성 예시
const userOp = await userOpBuilder.buildUserOp({
  permissionsContext: response.context,
  calls: [{ to: target, data: callData }]
});
```

### ERC-7710 (위임)과 통합

계정 유형 서명자는 `delegationManager` 주소를 반환합니다. DApp은 권한 컨텍스트와 원하는 작업 구조체로 `redeemDelegation` 함수를 호출하여 위임된 트랜잭션을 실행합니다.

```typescript
// 위임 실행 예시
await delegationManager.redeemDelegations(
  [permissionContext],
  [mode],
  [executionCallData]
);
```

### ERC-5792 (배치 호출)와 통합

지갑 관리 세션은 `permissionsContext`가 포함된 `permissions` 기능과 함께 `wallet_sendCalls`를 지원하여 반복적인 사용자 확인을 제거합니다.

```json
{
  "method": "wallet_sendCalls",
  "params": [{
    "calls": [...],
    "capabilities": {
      "permissions": {
        "context": "0x..."
      }
    }
  }]
}
```

## 근거

### 유연한 permissionsContext 설계

불투명 컨텍스트 필드는 세 가지 구별되는 시행 체계를 수용합니다:
1. ERC-7679 UserOp 빌더
2. ERC-7710 위임 관리자
3. 인앱 세션 식별자

이를 통해 지갑 구현의 유연성을 극대화합니다.

### 확장 가능한 서명자/권한 유형

폐쇄된 집합을 강제하는 대신, 이 명세는 충돌을 방지하면서 미래 지갑 기능을 허용하기 위해 새로운 유형의 ERC 기반 표준화를 권장합니다.

## 보안 고려사항

### 제한된 권한 범위

DApp은 합리적인 만료 기간과 함께 필요한 최소한의 권한만 요청해야 합니다. 지갑은 올바른 시행에 대한 책임을 지며, 사용자는 지갑 구현을 신뢰해야 합니다.

### 피싱 완화

지갑은 요청된 권한을 명확하게 표시하고 사회공학 공격을 방지하기 위해 과도한 권한 부여에 대해 사용자에게 경고해야 합니다.

**권장 사항**:
- 권한 요청을 명확하고 이해하기 쉬운 언어로 표시
- 비정상적으로 높은 한도나 긴 만료 기간에 대해 경고
- 이전에 상호작용하지 않은 DApp에 대해 추가 확인 요청

## 하위 호환성

`wallet_grantPermissions` 지원이 없는 지갑은 호출 시 표준 JSON-RPC 오류 응답을 반환해야 합니다.

```json
{
  "error": {
    "code": -32601,
    "message": "Method not found"
  }
}
```

## 사용 사례

### 정기 구독

```typescript
// 월간 구독 권한 요청
const subscription = await wallet.grantPermissions({
  expiry: Date.now() / 1000 + 365 * 24 * 60 * 60, // 1년
  signer: { type: 'key', data: { type: 'secp256r1', publicKey } },
  permissions: [{
    type: 'erc20-token-transfer',
    data: { tokenAddress: USDC },
    policies: [
      { type: 'token-allowance', data: { allowance: '1200000000' } }, // $1200/년
      { type: 'rate-limit', data: { count: 1, interval: 2592000 } }   // 월 1회
    ]
  }]
});
```

### 게임 세션

```typescript
// 게임 세션 권한 요청
const gameSession = await wallet.grantPermissions({
  expiry: Date.now() / 1000 + 2 * 60 * 60, // 2시간
  signer: { type: 'wallet' },
  permissions: [{
    type: 'contract-call',
    data: { contractAddress: GAME_CONTRACT },
    policies: [
      { type: 'gas-limit', data: { limit: '1000000' } },
      { type: 'call-count', data: { count: 100 } }
    ]
  }]
});
```

## 의존성

- EIP-4337: Account Abstraction
- EIP-5792: Wallet Call Batching
- EIP-7679: UserOp Builder
- EIP-7710: Smart Contract Delegation

## 참조

- [ERC-7715 공식 문서](https://eips.ethereum.org/EIPS/eip-7715)
- [ERC-4337 Account Abstraction](https://eips.ethereum.org/EIPS/eip-4337)
- [ERC-7710 Smart Contract Delegation](https://eips.ethereum.org/EIPS/eip-7710)
